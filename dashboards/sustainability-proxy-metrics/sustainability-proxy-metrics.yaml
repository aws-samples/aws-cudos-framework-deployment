dashboards:
  SUS-DASH:
    category: 'Additional'
    dependsOn:
      datasets:
      - carbon_emissions_aggregate_longform
      - sus_carbon_emissions
      - sus_compute_ec2
      - sus_compute_split
      - sus_geo_region_athena
      - sus_idle_elb
      - sus_idle_natgw
      - sus_network
      - sus_s3_storage_all
      - sus_storage_athena
    name: sustainability-proxy-metrics
    dashboardId: sustainability-proxy-metrics
    category: Custom
    theme: MIDNIGHT
    templateId: sustainability-proxy-metrics
    sourceAccountId: '554422808410'
    region: eu-central-1
datasets:
  sus_s3_storage_all:
    data:
      DataSetId: 411db3d5-6368-4359-a4a6-29dbb64c9e33
      Name: sus_s3_storage_all
      PhysicalTableMap:
        2ca2f9db-d270-4f8f-8e0d-cce6f039328f:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: sus_s3_storage_all
            InputColumns:
            - Name: year
              Type: STRING
            - Name: month
              Type: STRING
            - Name: bill_payer_account_id
              Type: STRING
            - Name: billing_period
              Type: DATETIME
            - Name: usage_date
              Type: DATETIME
            - Name: payer_account_id
              Type: STRING
            - Name: linked_account_id
              Type: STRING
            - Name: resource_id
              Type: STRING
            - Name: product_code
              Type: STRING
            - Name: operation
              Type: STRING
            - Name: region
              Type: STRING
            - Name: charge_type
              Type: STRING
            - Name: pricing_unit
              Type: STRING
            - Name: resource_tags_user_application
              Type: STRING
            - Name: busskpitag
              Type: STRING
            - Name: busskpiacc
              Type: STRING
            - Name: tagbuskpi
              Type: INTEGER
            - Name: accbuskpi
              Type: INTEGER
            - Name: usage_quantity
              Type: DECIMAL
              SubType: FLOAT
            - Name: unblended_cost
              Type: DECIMAL
              SubType: FLOAT
            - Name: public_cost
              Type: DECIMAL
              SubType: FLOAT
        fe1b70ec-a568-4341-9265-db2fe41e6a13:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: account_map
            InputColumns:
            - Name: account_id
              Type: STRING
            - Name: parent_account_id
              Type: STRING
            - Name: account_name
              Type: STRING
            - Name: account_email_id
              Type: STRING
      LogicalTableMap:
        79a028a3-aae7-4f70-8f72-e654a6bf1464:
          Alias: sus_s3_storage_all
          Source:
            PhysicalTableId: 2ca2f9db-d270-4f8f-8e0d-cce6f039328f
        e0e5acc2-6064-4bbe-9221-f60dd0357017:
          Alias: account_map
          Source:
            PhysicalTableId: fe1b70ec-a568-4341-9265-db2fe41e6a13
        e1c4d02c-a385-4759-9fdb-99624e7d1c1d:
          Alias: Intermediate Table
          DataTransforms:
          - ProjectOperation:
              ProjectedColumns:
              - year
              - month
              - bill_payer_account_id
              - billing_period
              - usage_date
              - payer_account_id
              - linked_account_id
              - resource_id
              - product_code
              - operation
              - region
              - charge_type
              - pricing_unit
              - resource_tags_user_application
              - busskpitag
              - busskpiacc
              - tagbuskpi
              - accbuskpi
              - usage_quantity
              - unblended_cost
              - public_cost
              - account_id
              - parent_account_id
              - account_name
              - account_email_id
          Source:
            JoinInstruction:
              LeftOperand: 79a028a3-aae7-4f70-8f72-e654a6bf1464
              RightOperand: e0e5acc2-6064-4bbe-9221-f60dd0357017
              Type: LEFT
              OnClause: '{linked_account_id} = {account_id}'
      ImportMode: SPICE
    dependsOn:
      views:
      - sus_s3_storage_all
      - account_map
    schedules:
    - default
  sus_idle_elb:
    data:
      DataSetId: 2794b73a-4469-4b9c-ba4e-d1de93460b8b
      Name: sus_idle_elb
      PhysicalTableMap:
        8d1ead4d-1a2e-4641-947a-d8ffb40d653e:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: account_map
            InputColumns:
            - Name: account_id
              Type: STRING
            - Name: parent_account_id
              Type: STRING
            - Name: account_name
              Type: STRING
            - Name: account_email_id
              Type: STRING
        961a6efd-2ed4-4d1c-8f5a-e7ff676393c8:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: sus_idle_elb
            InputColumns:
            - Name: bill_payer_account_id
              Type: STRING
            - Name: bill_billing_period_start_date
              Type: DATETIME
            - Name: line_item_usage_account_id
              Type: STRING
            - Name: split_line_item_resource_id
              Type: STRING
            - Name: product_region
              Type: STRING
            - Name: pricing_unit
              Type: STRING
            - Name: sum_line_item_usage_amount
              Type: DECIMAL
              SubType: FLOAT
            - Name: resource_tags_user_application
              Type: STRING
            - Name: tagbuskpi
              Type: INTEGER
            - Name: accbuskpi
              Type: INTEGER
            - Name: sum_line_item_unblended_cost
              Type: DECIMAL
              SubType: FIXED
      LogicalTableMap:
        16f9dbb4-1845-488b-9382-dba4fe06a027:
          Alias: sus_idle_elb
          Source:
            PhysicalTableId: 961a6efd-2ed4-4d1c-8f5a-e7ff676393c8
        338c012f-691e-4a8b-b163-b0d03d16da30:
          Alias: account_map
          Source:
            PhysicalTableId: 8d1ead4d-1a2e-4641-947a-d8ffb40d653e
        83c9024c-38bf-4e67-9802-523dbeea187f:
          Alias: Intermediate Table
          DataTransforms:
          - TagColumnOperation:
              ColumnName: product_region
              Tags:
              - ColumnGeographicRole: STATE
          - ProjectOperation:
              ProjectedColumns:
              - bill_payer_account_id
              - bill_billing_period_start_date
              - line_item_usage_account_id
              - split_line_item_resource_id
              - product_region
              - pricing_unit
              - sum_line_item_usage_amount
              - resource_tags_user_application
              - tagbuskpi
              - accbuskpi
              - sum_line_item_unblended_cost
              - account_id
              - parent_account_id
              - account_name
              - account_email_id
          Source:
            JoinInstruction:
              LeftOperand: 16f9dbb4-1845-488b-9382-dba4fe06a027
              RightOperand: 338c012f-691e-4a8b-b163-b0d03d16da30
              Type: LEFT
              OnClause: '{line_item_usage_account_id} = {account_id}'
      ImportMode: SPICE
    dependsOn:
      views:
      - account_map
      - sus_idle_elb
    schedules:
    - default
  sus_compute_ec2:
    data:
      DataSetId: cf4c1a8b-6e9a-4cac-b2da-d82c970271e4
      Name: sus_compute_ec2
      PhysicalTableMap:
        862dc931-5aeb-45bd-aa09-0560920c43f0:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: sus_compute_ec2
            InputColumns:
            - Name: bill_payer_account_id
              Type: STRING
            - Name: line_item_usage_account_id
              Type: STRING
            - Name: line_item_usage_start_date
              Type: DATETIME
            - Name: resource_tags_user_application
              Type: STRING
            - Name: line_item_product_code
              Type: STRING
            - Name: product_instance_type_family
              Type: STRING
            - Name: product_physical_processor
              Type: STRING
            - Name: vcpu_hours
              Type: DECIMAL
              SubType: FLOAT
            - Name: tag_business_metric
              Type: INTEGER
            - Name: account_business_metric
              Type: INTEGER
        937e5fa9-bb37-4b63-a607-f8c1d0a7ca9b:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: account_map
            InputColumns:
            - Name: account_id
              Type: STRING
            - Name: parent_account_id
              Type: STRING
            - Name: account_name
              Type: STRING
            - Name: account_email_id
              Type: STRING
      LogicalTableMap:
        49d5b0fd-0993-4374-a034-a87d662add3f:
          Alias: Intermediate Table
          DataTransforms:
          - ProjectOperation:
              ProjectedColumns:
              - bill_payer_account_id
              - line_item_usage_account_id
              - line_item_usage_start_date
              - resource_tags_user_application
              - line_item_product_code
              - product_instance_type_family
              - product_physical_processor
              - vcpu_hours
              - tag_business_metric
              - account_business_metric
              - account_id
              - parent_account_id
              - account_name
              - account_email_id
          Source:
            JoinInstruction:
              LeftOperand: ab737a73-894c-4495-b12d-bf17cfb6b935
              RightOperand: 4d22feb2-2623-4113-a230-ee69aa825fd3
              Type: LEFT
              OnClause: '{line_item_usage_account_id} = {account_id}'
        4d22feb2-2623-4113-a230-ee69aa825fd3:
          Alias: account_map
          Source:
            PhysicalTableId: 937e5fa9-bb37-4b63-a607-f8c1d0a7ca9b
        ab737a73-894c-4495-b12d-bf17cfb6b935:
          Alias: sus_compute_ec2
          Source:
            PhysicalTableId: 862dc931-5aeb-45bd-aa09-0560920c43f0
      ImportMode: SPICE
    dependsOn:
      views:
      - sus_compute_ec2
      - account_map
    schedules:
    - default
  sus_carbon_emissions:
    data:
      DataSetId: 12419d71-ec67-4e23-bd1f-fcd7b34c82f9
      Name: sus_carbon_emissions
      PhysicalTableMap:
        1dc4c009-196c-489a-970b-561bf4acef6b:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: sus_carbon_emissions_view
            InputColumns:
            - Name: accountid
              Type: STRING
            - Name: querydate
              Type: DATETIME
            - Name: startdate
              Type: DATETIME
            - Name: mbmcarbon
              Type: DECIMAL
              SubType: FIXED
            - Name: paceproductcode
              Type: STRING
            - Name: regioncode
              Type: STRING
        4e57d6b4-c367-411e-a44b-7870baa54c39:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: account_map
            InputColumns:
            - Name: account_id
              Type: STRING
            - Name: parent_account_id
              Type: STRING
            - Name: account_name
              Type: STRING
            - Name: account_email_id
              Type: STRING
      LogicalTableMap:
        485c1f21-5a4c-46bb-9abb-5e721c34ee9a:
          Alias: account_map
          Source:
            PhysicalTableId: 4e57d6b4-c367-411e-a44b-7870baa54c39
        81a5d7b4-3f4e-4083-8cdd-06268e2b5a7b:
          Alias: Intermediate Table
          DataTransforms:
          - ProjectOperation:
              ProjectedColumns:
              - accountid
              - querydate
              - startdate
              - mbmcarbon
              - paceproductcode
              - regioncode
              - account_id
              - parent_account_id
              - account_name
              - account_email_id
          Source:
            JoinInstruction:
              LeftOperand: a76d55cc-a67b-4ff3-8097-745706bf40fe
              RightOperand: 485c1f21-5a4c-46bb-9abb-5e721c34ee9a
              Type: LEFT
              OnClause: '{accountid} = {account_id}'
        a76d55cc-a67b-4ff3-8097-745706bf40fe:
          Alias: sus_carbon_emissions_view
          Source:
            PhysicalTableId: 1dc4c009-196c-489a-970b-561bf4acef6b
      ImportMode: SPICE
    dependsOn:
      views:
      - sus_carbon_emissions_view
      - account_map
    schedules:
    - default
  carbon_emissions_aggregate_longform:
    data:
      DataSetId: 814f2ac6-3205-43b8-ac8b-bab4dc1c864a
      Name: carbon_emissions_aggregate_longform
      PhysicalTableMap:
        c58a049b-ecf8-4884-8916-2b8ec86bd941:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: account_map
            InputColumns:
            - Name: account_id
              Type: STRING
            - Name: parent_account_id
              Type: STRING
            - Name: account_name
              Type: STRING
            - Name: account_email_id
              Type: STRING
        d0ea6867-d523-452c-b6a3-7431979da256:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: sus_carbon_emissions_longform
            InputColumns:
            - Name: metric
              Type: STRING
            - Name: value
              Type: DECIMAL
              SubType: FIXED
            - Name: accountid
              Type: STRING
            - Name: querydate
              Type: DATETIME
            - Name: startdate
              Type: DATETIME
      LogicalTableMap:
        1c4e087c-344e-4ad0-b986-aa01476f6091:
          Alias: sus_carbon_emissions_longform
          Source:
            PhysicalTableId: d0ea6867-d523-452c-b6a3-7431979da256
        5dc3e114-3a3d-43ff-87af-eae4d8d4cf8c:
          Alias: account_map
          Source:
            PhysicalTableId: c58a049b-ecf8-4884-8916-2b8ec86bd941
        67d16571-dce6-4ca0-a4d3-8e2cdc60bc05:
          Alias: Intermediate Table
          DataTransforms:
          - ProjectOperation:
              ProjectedColumns:
              - metric
              - value
              - accountid
              - querydate
              - startdate
              - account_id
              - parent_account_id
              - account_name
              - account_email_id
          Source:
            JoinInstruction:
              LeftOperand: 1c4e087c-344e-4ad0-b986-aa01476f6091
              RightOperand: 5dc3e114-3a3d-43ff-87af-eae4d8d4cf8c
              Type: LEFT
              OnClause: '{accountid} = {account_id}'
      ImportMode: SPICE
    dependsOn:
      views:
      - account_map
      - sus_carbon_emissions_longform
    schedules:
    - default
  sus_storage_athena:
    data:
      DataSetId: af858de6-f6ef-4961-88c4-964aa1266b9a
      Name: sus_storage_athena
      PhysicalTableMap:
        d88e946b-50c5-4131-af7f-a20c19b5f44d:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: sus_storage_athena
            InputColumns:
            - Name: bill_payer_account_id
              Type: STRING
            - Name: resource_tags_user_application
              Type: STRING
            - Name: line_item_usage_account_id
              Type: STRING
            - Name: line_item_operation
              Type: STRING
            - Name: line_item_usage_start_date
              Type: DATETIME
            - Name: usage
              Type: DECIMAL
              SubType: FLOAT
            - Name: tagbuskpi
              Type: INTEGER
            - Name: accbuskpi
              Type: INTEGER
        e7b46e3d-87cf-473e-908b-7870ffa90a32:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: account_map
            InputColumns:
            - Name: account_id
              Type: STRING
            - Name: parent_account_id
              Type: STRING
            - Name: account_name
              Type: STRING
            - Name: account_email_id
              Type: STRING
      LogicalTableMap:
        13ed66ff-e221-4acf-9e83-87145cf336c5:
          Alias: account_map
          Source:
            PhysicalTableId: e7b46e3d-87cf-473e-908b-7870ffa90a32
        3bf588fa-4b55-4746-b422-1799d4cb51ff:
          Alias: sus_storage_athena
          Source:
            PhysicalTableId: d88e946b-50c5-4131-af7f-a20c19b5f44d
        b85579e2-a38d-41ea-a583-7055af4d54d1:
          Alias: Intermediate Table
          DataTransforms:
          - ProjectOperation:
              ProjectedColumns:
              - bill_payer_account_id
              - resource_tags_user_application
              - line_item_usage_account_id
              - line_item_operation
              - line_item_usage_start_date
              - usage
              - tagbuskpi
              - accbuskpi
              - account_id
              - parent_account_id
              - account_name
              - account_email_id
          Source:
            JoinInstruction:
              LeftOperand: 3bf588fa-4b55-4746-b422-1799d4cb51ff
              RightOperand: 13ed66ff-e221-4acf-9e83-87145cf336c5
              Type: LEFT
              OnClause: '{line_item_usage_account_id} = {account_id}'
      ImportMode: SPICE
    dependsOn:
      views:
      - sus_storage_athena
      - account_map
    schedules:
    - default
  sus_geo_region_athena:
    data:
      DataSetId: b5c8fb38-99a9-4764-9eac-7cbfa856571e
      Name: sus_geo_region_athena
      PhysicalTableMap:
        2d73b781-2ce6-41a2-9ba0-a193d7aba3ec:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: sus_geo_region_athena
            InputColumns:
            - Name: bill_payer_account_id
              Type: STRING
            - Name: usage_date
              Type: DATETIME
            - Name: region
              Type: STRING
            - Name: region_latitude
              Type: STRING
            - Name: region_longitude
              Type: STRING
            - Name: is95percentrenewable
              Type: INTEGER
            - Name: cost
              Type: DECIMAL
              SubType: FIXED
      LogicalTableMap:
        ea7b9711-1cfb-47ce-a7f1-2d7686890f72:
          Alias: sus_geo_region_athena
          DataTransforms:
          - CastColumnTypeOperation:
              ColumnName: region_latitude
              NewColumnType: DECIMAL
              SubType: FIXED
          - CastColumnTypeOperation:
              ColumnName: region_longitude
              NewColumnType: DECIMAL
              SubType: FIXED
          - TagColumnOperation:
              ColumnName: region
              Tags:
              - ColumnGeographicRole: STATE
          - TagColumnOperation:
              ColumnName: region_latitude
              Tags:
              - ColumnGeographicRole: LATITUDE
          - TagColumnOperation:
              ColumnName: region_longitude
              Tags:
              - ColumnGeographicRole: LONGITUDE
          - ProjectOperation:
              ProjectedColumns:
              - bill_payer_account_id
              - usage_date
              - region
              - region_latitude
              - region_longitude
              - is95percentrenewable
              - cost
          Source:
            PhysicalTableId: 2d73b781-2ce6-41a2-9ba0-a193d7aba3ec
      ImportMode: SPICE
    dependsOn:
      views:
      - sus_geo_region_athena
    schedules:
    - default
  sus_network:
    data:
      DataSetId: 656e7432-12cf-4b1c-a48f-24e4f4b48843
      Name: sus_network
      PhysicalTableMap:
        4f66d90f-5d4a-4e8e-bcdf-2e83d73d37a8:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: account_map
            InputColumns:
            - Name: account_id
              Type: STRING
            - Name: parent_account_id
              Type: STRING
            - Name: account_name
              Type: STRING
            - Name: account_email_id
              Type: STRING
        b4b4e384-904f-42b3-9108-3dff4ad53b30:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: sus_network
            InputColumns:
            - Name: bill_payer_account_id
              Type: STRING
            - Name: line_item_usage_account_id
              Type: STRING
            - Name: line_item_usage_start_date
              Type: DATETIME
            - Name: line_item_product_code
              Type: STRING
            - Name: line_item_line_item_type
              Type: STRING
            - Name: line_item_operation
              Type: STRING
            - Name: line_item_usage_type
              Type: STRING
            - Name: product_product_name
              Type: STRING
            - Name: product_region
              Type: STRING
            - Name: product_from_location
              Type: STRING
            - Name: product_to_location
              Type: STRING
            - Name: resource_tags_user_application
              Type: STRING
            - Name: line_item_line_item_description
              Type: STRING
            - Name: usage_amount_in_tb
              Type: DECIMAL
              SubType: FLOAT
            - Name: cost
              Type: DECIMAL
              SubType: FLOAT
            - Name: tagbuskpi
              Type: INTEGER
            - Name: accbuskpi
              Type: INTEGER
      LogicalTableMap:
        9d386b3d-9b75-4e72-b307-56678a6e8f96:
          Alias: account_map
          Source:
            PhysicalTableId: 4f66d90f-5d4a-4e8e-bcdf-2e83d73d37a8
        a74b2b69-a10d-4b60-8c4c-68529a0707d9:
          Alias: Intermediate Table
          DataTransforms:
          - TagColumnOperation:
              ColumnName: product_region
              Tags:
              - ColumnGeographicRole: STATE
          - ProjectOperation:
              ProjectedColumns:
              - bill_payer_account_id
              - line_item_usage_account_id
              - line_item_usage_start_date
              - line_item_product_code
              - line_item_line_item_type
              - line_item_operation
              - line_item_usage_type
              - product_product_name
              - product_region
              - product_from_location
              - product_to_location
              - resource_tags_user_application
              - line_item_line_item_description
              - usage_amount_in_tb
              - cost
              - tagbuskpi
              - accbuskpi
              - account_id
              - parent_account_id
              - account_name
              - account_email_id
          Source:
            JoinInstruction:
              LeftOperand: d8a05f09-6cb3-40e0-b9c8-482512b1727a
              RightOperand: 9d386b3d-9b75-4e72-b307-56678a6e8f96
              Type: LEFT
              OnClause: '{line_item_usage_account_id} = {account_id}'
        d8a05f09-6cb3-40e0-b9c8-482512b1727a:
          Alias: sus_network
          Source:
            PhysicalTableId: b4b4e384-904f-42b3-9108-3dff4ad53b30
      ImportMode: SPICE
    dependsOn:
      views:
      - account_map
      - sus_network
    schedules:
    - default
  sus_idle_natgw:
    data:
      DataSetId: c8a8cb07-8d9d-4b90-9862-e2a7e1370908
      Name: sus_idle_natgw
      PhysicalTableMap:
        0766af2c-5154-4b8a-a5df-8d9a2d37efb4:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: account_map
            InputColumns:
            - Name: account_id
              Type: STRING
            - Name: parent_account_id
              Type: STRING
            - Name: account_name
              Type: STRING
            - Name: account_email_id
              Type: STRING
        30332fbc-ad6f-47ec-b5d2-c6bd31f5efc4:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: sus_idle_natgw
            InputColumns:
            - Name: bill_payer_account_id
              Type: STRING
            - Name: line_item_usage_account_id
              Type: STRING
            - Name: bill_billing_period_start_date
              Type: DATETIME
            - Name: split_line_item_resource_id
              Type: STRING
            - Name: product_region
              Type: STRING
            - Name: pricing_unit
              Type: STRING
            - Name: sum_line_item_usage_amount
              Type: DECIMAL
              SubType: FLOAT
            - Name: resource_tags_user_application
              Type: STRING
            - Name: sum_line_item_unblended_cost
              Type: DECIMAL
              SubType: FIXED
            - Name: tagbuskpi
              Type: INTEGER
            - Name: accbuskpi
              Type: INTEGER
      LogicalTableMap:
        6663e8a1-6723-49ae-9312-b51275135aec:
          Alias: sus_idle_natgw
          Source:
            PhysicalTableId: 30332fbc-ad6f-47ec-b5d2-c6bd31f5efc4
        d1e76cc3-b08d-42bc-a7f3-8edf0b5e73df:
          Alias: Intermediate Table
          DataTransforms:
          - TagColumnOperation:
              ColumnName: product_region
              Tags:
              - ColumnGeographicRole: STATE
          - ProjectOperation:
              ProjectedColumns:
              - bill_payer_account_id
              - line_item_usage_account_id
              - bill_billing_period_start_date
              - split_line_item_resource_id
              - product_region
              - pricing_unit
              - sum_line_item_usage_amount
              - resource_tags_user_application
              - sum_line_item_unblended_cost
              - tagbuskpi
              - accbuskpi
              - account_id
              - parent_account_id
              - account_name
              - account_email_id
          Source:
            JoinInstruction:
              LeftOperand: 6663e8a1-6723-49ae-9312-b51275135aec
              RightOperand: ea340ec0-1f14-40d4-becc-4b992b546138
              Type: LEFT
              OnClause: '{line_item_usage_account_id} = {account_id}'
        ea340ec0-1f14-40d4-becc-4b992b546138:
          Alias: account_map
          Source:
            PhysicalTableId: 0766af2c-5154-4b8a-a5df-8d9a2d37efb4
      ImportMode: SPICE
    dependsOn:
      views:
      - account_map
      - sus_idle_natgw
    schedules:
    - default
  sus_compute_split:
    data:
      DataSetId: 20912ab9-05e1-48c0-99f7-b70e68c743f0
      Name: sus_compute_split
      PhysicalTableMap:
        3dd3174f-61ea-420e-8ea9-d7fb30a929ef:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: sus_compute_split
            InputColumns:
            - Name: bill_payer_account_id
              Type: STRING
            - Name: line_item_usage_account_id
              Type: STRING
            - Name: line_item_usage_start_date
              Type: DATETIME
            - Name: resource_tags_user_application
              Type: STRING
            - Name: line_item_product_code
              Type: STRING
            - Name: vcpu_hours
              Type: DECIMAL
              SubType: FLOAT
            - Name: tag_business_metric
              Type: INTEGER
            - Name: account_business_metric
              Type: INTEGER
        7c5b80e9-7ba4-42bd-b626-4f8500c0ef00:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: account_map
            InputColumns:
            - Name: account_id
              Type: STRING
            - Name: parent_account_id
              Type: STRING
            - Name: account_name
              Type: STRING
            - Name: account_email_id
              Type: STRING
      LogicalTableMap:
        38318059-ada4-43cd-84e7-465c830634d4:
          Alias: Intermediate Table
          DataTransforms:
          - ProjectOperation:
              ProjectedColumns:
              - bill_payer_account_id
              - line_item_usage_account_id
              - line_item_usage_start_date
              - resource_tags_user_application
              - line_item_product_code
              - vcpu_hours
              - tag_business_metric
              - account_business_metric
              - account_id
              - parent_account_id
              - account_name
              - account_email_id
          Source:
            JoinInstruction:
              LeftOperand: 3af7087e-542f-439f-b88c-822cc9cacd3c
              RightOperand: 3b98fdf2-4730-401d-b095-59581cce1db9
              Type: LEFT
              OnClause: '{line_item_usage_account_id} = {account_id}'
        3af7087e-542f-439f-b88c-822cc9cacd3c:
          Alias: sus_compute_split
          Source:
            PhysicalTableId: 3dd3174f-61ea-420e-8ea9-d7fb30a929ef
        3b98fdf2-4730-401d-b095-59581cce1db9:
          Alias: account_map
          Source:
            PhysicalTableId: 7c5b80e9-7ba4-42bd-b626-4f8500c0ef00
      ImportMode: SPICE
    dependsOn:
      views:
      - sus_compute_split
      - account_map
    schedules:
    - default
crawlers: {}
views:
  sus_s3_storage_all:
    dependsOn:
      views:
      - sus_buss_kpi
      cur: true
    parameters:
      tag:
        type: 'cur.tag_and_cost_category_fields'
        default: resource_tags_user_application
        description: "Enter tag name that is used to categorize workloads"
        global: True
    data: |-
      CREATE OR REPLACE VIEW ${athena_database_name}.sus_s3_storage_all AS
      WITH
        TAG_KPI_PER_DAY AS (
         SELECT
           line_item_usage_start_date line_item_usage_start_date
         , tagvalue
         , "sum"(buss) busKpi
         FROM
           ${athena_database_name}.sus_buss_kpi
         GROUP BY line_item_usage_start_date, tagvalue
      )
      , ACC_KPI_PER_DAY AS (
         SELECT
           line_item_usage_start_date line_item_usage_start_date
         , linkedaccountvalue linkedaccountvalue
         , "sum"(buss) busKpi
         FROM
           ${athena_database_name}.sus_buss_kpi
         GROUP BY line_item_usage_start_date, linkedaccountvalue
      )
      SELECT DISTINCT
        "year"
      , "month"
      , cur.bill_payer_account_id
      , cur.bill_billing_period_start_date "billing_period"
      , cur.line_item_usage_start_date "usage_date"
      , "bill_payer_account_id" "payer_account_id"
      , "line_item_usage_account_id" "linked_account_id"
      , "line_item_resource_id" "resource_id"
      , "line_item_product_code" "product_code"
      , "line_item_operation" "operation"
      , "product_region" "region"
      , "line_item_line_item_type" "charge_type"
      , "pricing_unit" "pricing_unit"
      , ${tag} resource_tags_user_application
      , susTag.tagvalue bussKpiTag
      , susAcc.linkedaccountvalue bussKpiAcc
      , "sum"(susTag.busKpi) TagBusKpi
      , "sum"(susAcc.busKpi) AccBusKpi
      , "sum"((CASE WHEN ("line_item_line_item_type" = 'Usage') THEN "line_item_usage_amount" ELSE 0 END)) "usage_quantity"
      , "sum"("line_item_unblended_cost") "unblended_cost"
      , "sum"("pricing_public_on_demand_cost") "public_cost"
      FROM
        ((${athena_database_name}.${cur_table_name} cur
      LEFT JOIN TAG_KPI_PER_DAY susTag ON ((cur.line_item_usage_start_date = susTag.line_item_usage_start_date) AND (${tag} = susTag.tagValue)))
      LEFT JOIN ACC_KPI_PER_DAY susAcc ON ((cur.line_item_usage_start_date = susAcc.line_item_usage_start_date) AND (cur.line_item_usage_account_id = susAcc.linkedaccountvalue)))
      WHERE ((("line_item_operation" LIKE '%Storage%') AND (("line_item_product_code" LIKE '%AmazonGlacier%') OR ("line_item_product_code" LIKE '%AmazonS3%'))) AND ((cur.bill_billing_period_start_date >= (DATE_TRUNC('month', current_timestamp) - INTERVAL  '7' MONTH)) AND (CAST(CONCAT(cur.year, '-', cur.month, '-01') AS date) >= (DATE_TRUNC('month', current_date) - INTERVAL  '7' MONTH))))
      GROUP BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16
  sus_buss_kpi:
    dependsOn:
      cur: true
    parameters:
      tag:
        type: 'cur.tag_and_cost_category_fields'
        default: resource_tags_user_application
        description: "Enter tag name that is used to categorize workloads"
        global: True
    data: |-
      CREATE OR REPLACE VIEW ${athena_database_name}.sus_buss_kpi AS
      SELECT
        ${tag} tagValue
      , line_item_usage_account_id linkedAccountValue
      , line_item_usage_start_date
      , CAST(("random"() * 1000) AS int) buss
      FROM
        ${athena_database_name}.${cur_table_name} cur
      GROUP BY line_item_usage_start_date, line_item_usage_account_id, 1
  account_map:
    dependsOn:
      cur: true
    data: |-
      CREATE OR REPLACE VIEW ${athena_database_name}.account_map AS
      SELECT DISTINCT
        line_item_usage_account_id account_id
      , MAX_BY(bill_payer_account_id, line_item_usage_start_date) parent_account_id
      , MAX_BY(line_item_usage_account_id, line_item_usage_start_date) account_name
      , MAX_BY(line_item_usage_account_id, line_item_usage_start_date) account_email_id
      FROM
        "${cur_table_name}"
      GROUP BY line_item_usage_account_id
  sus_idle_elb:
    dependsOn:
      views:
      - sus_buss_kpi
      cur: true
    parameters:
      tag:
        type: 'cur.tag_and_cost_category_fields'
        default: resource_tags_user_application
        description: "Enter tag name that is used to categorize workloads"
        global: True
    data: |-
      CREATE OR REPLACE VIEW ${athena_database_name}.sus_idle_elb AS
      WITH
        TAG_KPI_PER_DAY AS (
         SELECT
           line_item_usage_start_date line_item_usage_start_date
         , tagvalue
         , "sum"(buss) busKpi
         FROM
           ${athena_database_name}.sus_buss_kpi
         GROUP BY line_item_usage_start_date, tagvalue
      )
      , ACC_KPI_PER_DAY AS (
         SELECT
           line_item_usage_start_date line_item_usage_start_date
         , linkedaccountvalue linkedaccountvalue
         , "sum"(buss) busKpi
         FROM
           ${athena_database_name}.sus_buss_kpi
         GROUP BY line_item_usage_start_date, linkedaccountvalue
      )
      SELECT
        bill_payer_account_id
      , bill_billing_period_start_date
      , line_item_usage_account_id
      , "split_part"(line_item_resource_id, ':', 6) split_line_item_resource_id
      , product_region
      , pricing_unit
      , sum_line_item_usage_amount
      , resource_tags_user_application
      , TagBusKpi
      , AccBusKpi
      , CAST(cost_per_resource AS decimal(16, 8)) sum_line_item_unblended_cost
      FROM
        (
         SELECT
           line_item_resource_id
         , bill_billing_period_start_date
         , product_region
         , pricing_unit
         , line_item_usage_account_id
         , bill_payer_account_id
         , ${tag} resource_tags_user_application
         , "sum"(line_item_usage_amount) sum_line_item_usage_amount
         , "sum"("sum"(line_item_unblended_cost)) OVER (PARTITION BY line_item_resource_id) cost_per_resource
         , "sum"("sum"(line_item_usage_amount)) OVER (PARTITION BY line_item_resource_id, pricing_unit) usage_per_resource_and_pricing_unit
         , "sum"(susTag.busKpi) TagBusKpi
         , "sum"(susAcc.busKpi) AccBusKpi
         , "count"(pricing_unit) OVER (PARTITION BY line_item_resource_id, bill_billing_period_start_date) pricing_unit_per_resource
         FROM
           ((${athena_database_name}.${cur_table_name} cur
         LEFT JOIN TAG_KPI_PER_DAY susTag ON ((cur.line_item_usage_start_date = susTag.line_item_usage_start_date) AND (${tag} = susTag.tagValue)))
         LEFT JOIN ACC_KPI_PER_DAY susAcc ON ((cur.line_item_usage_start_date = susAcc.line_item_usage_start_date) AND (cur.line_item_usage_account_id = susAcc.linkedaccountvalue)))
         WHERE (((line_item_product_code = 'AWSELB') AND (("bill_billing_period_start_date" >= ("date_trunc"('month', current_timestamp) - INTERVAL  '7' MONTH)) AND (CAST("concat"("year", '-', "month", '-01') AS date) >= ("date_trunc"('month', current_date) - INTERVAL  '7' MONTH)))) AND (line_item_line_item_type = 'Usage'))
         GROUP BY line_item_resource_id, bill_billing_period_start_date, product_region, pricing_unit, line_item_usage_account_id, bill_payer_account_id, 7
      )
      WHERE ((usage_per_resource_and_pricing_unit > 336) AND (pricing_unit_per_resource = 1))
  sus_compute_ec2:
    parameters:
      tag:
        type: 'cur.tag_and_cost_category_fields'
        default: resource_tags_user_application
        description: "Enter tag name that is used to categorize workloads"
        global: True
    dependsOn:
      views:
      - sus_buss_kpi
      cur: true
    data: |-
      CREATE OR REPLACE VIEW ${athena_database_name}.sus_compute_ec2 AS
      WITH
        tag_business_metrics AS (
         SELECT
           line_item_usage_start_date
         , tagvalue
         , SUM(buss) business_metric
         FROM
           ${athena_database_name}.sus_buss_kpi
         GROUP BY line_item_usage_start_date, tagvalue
      )
      , acc_business_metrics AS (
         SELECT
           line_item_usage_start_date
         , linkedaccountvalue
         , SUM(buss) business_metric
         FROM
           ${athena_database_name}.sus_buss_kpi
         GROUP BY line_item_usage_start_date, linkedaccountvalue
      )
      SELECT
        cur.bill_payer_account_id
      , cur.line_item_usage_account_id
      , cur.line_item_usage_start_date
      , ${tag} resource_tags_user_application
      , cur.line_item_product_code
      , (CASE WHEN ((product_instance_type_family IS NULL) OR (product_instance_type_family = '')) THEN split(product_instance_type, '.')[1] ELSE product_instance_type_family END) product_instance_type_family
      , cur.product_physical_processor
      , SUM((cur.line_item_usage_amount * CAST(cur.product_vcpu AS double))) vcpu_hours
      , SUM(susTag.business_metric) tag_business_metric
      , SUM(susAcc.business_metric) account_business_metric
      FROM
        ((${cur_table_name} cur
      LEFT JOIN tag_business_metrics susTag ON ((cur.line_item_usage_start_date = susTag.line_item_usage_start_date) AND (${tag} = susTag.tagValue)))
      LEFT JOIN acc_business_metrics susAcc ON ((cur.line_item_usage_start_date = susAcc.line_item_usage_start_date) AND (cur.line_item_usage_account_id = susAcc.linkedaccountvalue)))
      WHERE ((((cur.product_product_family = 'Compute Instance') OR (cur.product_product_family = 'Dedicated Host')) AND (cur.line_item_product_code = 'AmazonEC2') AND (cur.line_item_operation LIKE 'RunInstances%') AND (cur.line_item_line_item_type IN ('Usage', 'SavingsPlanCoveredUsage', 'DiscountedUsage'))) AND ((cur.bill_billing_period_start_date >= (DATE_TRUNC('month', current_timestamp) - INTERVAL  '17' MONTH)) AND (CAST(CONCAT(cur.year, '-', cur.month, '-01') AS date) >= (DATE_TRUNC('month', current_date) - INTERVAL  '17' MONTH))))
      GROUP BY 1, 2, 3, 4, 5, 6, 7
  sus_carbon_emissions_view:
    data: |-
      CREATE OR REPLACE VIEW ${athena_database_name}.sus_carbon_emissions_view AS
      SELECT
        '123456789789' accountid
      , '2024-01-01' querydate
      , '2024-01-01' startdate
      , 0E0 mbmcarbon
      , 'no-data' paceproductcode
      , 'no-data' regioncode
      WHERE (1 = 0)
  sus_carbon_emissions_longform:
    data: |-
      CREATE OR REPLACE VIEW ${athena_database_name}.sus_carbon_emissions_longform AS
      SELECT
        'gridmixinefficiency' metric
      , 0E0 value
      , '123456789789' accountid
      , '2024-03-07' querydate
      , '2020-12-01' startdate
      WHERE (1 = 0)
  sus_storage_athena:
    dependsOn:
      views:
      - sus_buss_kpi
      cur: true
    parameters:
      tag:
        type: 'cur.tag_and_cost_category_fields'
        default: resource_tags_user_application
        description: "Enter tag name that is used to categorize workloads"
        global: True
    data: |-
      CREATE OR REPLACE VIEW ${athena_database_name}.sus_storage_athena AS
      WITH
        TAG_KPI_PER_DAY AS (
         SELECT
           line_item_usage_start_date line_item_usage_start_date
         , tagvalue
         , "sum"(buss) busKpi
         FROM
           ${athena_database_name}.sus_buss_kpi
         GROUP BY line_item_usage_start_date, tagvalue
      )
      , ACC_KPI_PER_DAY AS (
         SELECT
           line_item_usage_start_date line_item_usage_start_date
         , linkedaccountvalue linkedaccountvalue
         , "sum"(buss) busKpi
         FROM
           ${athena_database_name}.sus_buss_kpi
         GROUP BY line_item_usage_start_date, linkedaccountvalue
      )
      SELECT
        cur.bill_payer_account_id
      , ${tag} resource_tags_user_application
      , line_item_usage_account_id
      , line_item_operation
      , cur.line_item_usage_start_date
      , "sum"(line_item_usage_amount) Usage
      , "sum"(susTag.busKpi) TagBusKpi
      , "sum"(susAcc.busKpi) AccBusKpi
      FROM
        ((${athena_database_name}.${cur_table_name} cur
      LEFT JOIN TAG_KPI_PER_DAY susTag ON ((cur.line_item_usage_start_date = susTag.line_item_usage_start_date) AND (${tag} = susTag.tagValue)))
      LEFT JOIN ACC_KPI_PER_DAY susAcc ON ((cur.line_item_usage_start_date = susAcc.line_item_usage_start_date) AND (cur.line_item_usage_account_id = susAcc.linkedaccountvalue)))
      WHERE ((line_item_operation LIKE 'CreateVolume%') AND (("bill_billing_period_start_date" >= ("date_trunc"('month', current_timestamp) - INTERVAL  '7' MONTH)) AND (CAST("concat"("year", '-', "month", '-01') AS date) >= ("date_trunc"('month', current_date) - INTERVAL  '7' MONTH))))
      GROUP BY bill_payer_account_id, 2, line_item_usage_account_id, month, year, cur.line_item_usage_start_date, line_item_operation
  sus_aws_regions:
    data: |-
      CREATE OR REPLACE VIEW ${athena_database_name}.sus_aws_regions AS
       SELECT *
      FROM
        (
       VALUES
           ROW ('ap-northeast-1', 'Japan', 'Tokyo', '35.64', '139.76', 1)
         , ROW ('ap-south-1', 'India', 'Mumbai', '19.08', '72.88', 1)
         , ROW ('cn-northwest-1', 'China', 'Ningxia', '38.47', '106.26', 1)
         , ROW ('eu-central-1', 'Germany', 'Frankfurt', '50.11', '8.68', 1)
         , ROW ('eu-north-1', 'Sweden', 'Stockholm', '59.33', '18.07', 1)
         , ROW ('eu-west-1', 'Ireland', 'Dublin', '53.28', '-7.71', 1)
         , ROW ('us-east-2', 'USA', 'Ohio', '40.36', '-82.91', 1)
         , ROW ('us-gov-west-1', 'USA', 'Oregon', '39.53', '-119.88', 1)
         , ROW ('us-west-1', 'USA', 'N. California', '36.55', '-119.89', 1)
         , ROW ('us-west-2', 'USA', 'Oregon', '43.82', '-120.33', 1)
         , ROW ('ap-east-1', 'Hong Kong', 'Hong Kong', '22.28', '114.15', 0)
         , ROW ('ap-northeast-2', 'South Korea', 'Seoul', '37.72', '126.04', 0)
         , ROW ('ap-northeast-3', 'Japan', 'Osaka', '34.69', '135.5', 1)
         , ROW ('ap-southeast-2', 'Australia', 'Sydney', '-33.88', '151.23', 0)
         , ROW ('ca-central-1', 'Canada', 'Montreal', '44.08', '-77.42', 1)
         , ROW ('cn-north-1', 'China', 'Beijing', '39.91', '116.41', 1)
         , ROW ('eu-west-3', 'France', 'Paris', '48.85', '2.35', 1)
         , ROW ('me-south-1', 'Bahrain', 'Bahrain', '26.11', '50.50', 0)
         , ROW ('sa-east-1', 'Brazil', 'Sao Paulo', '-23.37', '-46.63', 0)
         , ROW ('us-gov-east-1', 'USA', 'Ohio', '40.4897', '-81.45', 1)
         , ROW ('ap-southeast-1', 'Singapore', 'Singapore', '1.35', '103.86', 0)
         , ROW ('eu-west-2', 'UK', 'London', '51.53', '0.12', 1)
         , ROW ('us-east-1', 'USA', 'Washington DC', '38.80', '-77.11', 1)
         , ROW ('eu-south-1', 'Italy', 'Milan', '45.46', '9.18', 1)
         , ROW ('af-south-1', 'Africa', 'Cape Town', '-33.91', '18.42', 0)
         , ROW ('ap-south-2', 'India', 'Hyderabad', '17.39', '78.49', 1)
         , ROW ('eu-central-2', 'Switzerland', 'Zurich', '47.37', '8.54', 1)
         , ROW ('eu-south-2', 'Spain', 'Madrid', '40.41', '-3.70',1)
         , ROW ('ap-southeast-3', 'Indonesia', 'Jakarta', '-6.175110', '106.865036',0)
        , ROW ('ap-southeast-5', 'Malaysia', 'Kuala Lumpur', '3.139003', '101.686852',0)
        , ROW ('ap-southeast-4', 'Australia', 'Melbourne', '-37.813629', '144.963058',0)
        , ROW ('ca-west-1', 'Canada', 'Calgary', '51.048615', '-114.070847',0)
        , ROW ('il-central-1', 'Israel', 'Tel Aviv', '32.085300', '34.781769',0)
        , ROW ('il-central-1', 'Middle East' , 'UAE', '25.276987', '55.296249',0)
      )  ignored_table_name (region_name, region_country, region_city, region_latitude, region_longitude, is95PercentRenewable)
  sus_geo_region_athena:
    dependsOn:
      cur: true
      views:
      - sus_aws_regions
    data: |-
      CREATE OR REPLACE VIEW ${athena_database_name}.sus_geo_region_athena AS
      SELECT
        bill_payer_account_id
      , line_item_usage_start_date "usage_date"
      , region_city region
      , region_latitude
      , region_longitude
      , is95PercentRenewable
      , "sum"(line_item_blended_cost) cost
      FROM
        (${athena_database_name}.${cur_table_name} cur
      INNER JOIN ${athena_database_name}.sus_aws_regions ON ("product_region" = sus_aws_regions.region_name))
      WHERE (((product_region <> '') AND (product_region <> 'global')) AND ((cur.bill_billing_period_start_date >= (DATE_TRUNC('month', current_timestamp) - INTERVAL  '17' MONTH)) AND (CAST(CONCAT(cur.year, '-', cur.month, '-01') AS date) >= (DATE_TRUNC('month', current_date) - INTERVAL  '17' MONTH))))
      GROUP BY bill_payer_account_id, line_item_usage_start_date, product_region, region_city, region_latitude, is95PercentRenewable, region_longitude
  sus_network:
    dependsOn:
      views:
      - sus_buss_kpi
      cur: true
    parameters:
      tag:
        type: 'cur.tag_and_cost_category_fields'
        default: resource_tags_user_application
        description: "Enter tag name that is used to categorize workloads"
        global: True
    data: |-
      CREATE OR REPLACE VIEW ${athena_database_name}.sus_network AS
      WITH
        TAG_KPI_PER_DAY AS (
         SELECT
           line_item_usage_start_date line_item_usage_start_date
         , tagvalue
         , "sum"(buss) busKpi
         FROM
           ${athena_database_name}.sus_buss_kpi
         GROUP BY line_item_usage_start_date, tagvalue
      )
      , ACC_KPI_PER_DAY AS (
         SELECT
           line_item_usage_start_date line_item_usage_start_date
         , linkedaccountvalue linkedaccountvalue
         , "sum"(buss) busKpi
         FROM
           ${athena_database_name}.sus_buss_kpi
         GROUP BY line_item_usage_start_date, linkedaccountvalue
      )
      SELECT
        bill_payer_account_id
      , line_item_usage_account_id
      , cur.line_item_usage_start_date
      , line_item_product_code
      , line_item_line_item_type
      , line_item_operation
      , line_item_usage_type
      , product_product_name
      , product_region
      , product_from_location
      , product_to_location
      , ${tag} resource_tags_user_application
      , line_item_line_item_description
      , "sum"((line_item_usage_amount / 1024)) usage_amount_in_tb
      , "sum"(line_item_blended_cost) cost
      , "sum"(susTag.busKpi) TagBusKpi
      , "sum"(susAcc.busKpi) AccBusKpi
      FROM
        ((${athena_database_name}.${cur_table_name} cur
      LEFT JOIN TAG_KPI_PER_DAY susTag ON ((cur.line_item_usage_start_date = susTag.line_item_usage_start_date) AND (${tag} = susTag.tagValue)))
      LEFT JOIN ACC_KPI_PER_DAY susAcc ON ((cur.line_item_usage_start_date = susAcc.line_item_usage_start_date) AND (cur.line_item_usage_account_id = susAcc.linkedaccountvalue)))
      WHERE ((((line_item_line_item_type = 'Usage') AND (NOT (line_item_usage_amount = 0))) AND (((line_item_usage_type LIKE '%Bytes') AND ((((line_item_usage_type LIKE '%In%') OR (line_item_usage_type LIKE '%Out%')) OR (line_item_usage_type LIKE 'Nat%')) OR (line_item_usage_type LIKE '%Regional%'))) AND ((product_from_location = '') OR (product_from_location LIKE '%(%')))) AND ((cur.bill_billing_period_start_date >= (DATE_TRUNC('month', current_timestamp) - INTERVAL  '7' MONTH)) AND (CAST(CONCAT(cur.year, '-', cur.month, '-01') AS date) >= (DATE_TRUNC('month', current_date) - INTERVAL  '7' MONTH))))
      GROUP BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13
  sus_compute_split:
    dependsOn:
      views:
      - sus_buss_kpi
      - sus_compute_ec2
      cur: true
    parameters:
      tag:
        type: 'cur.tag_and_cost_category_fields'
        default: resource_tags_user_application
        description: "Enter tag name that is used to categorize workloads"
        global: True
    data: |-
      CREATE OR REPLACE VIEW ${athena_database_name}.sus_compute_split AS
      WITH
        tag_business_metrics AS (
         SELECT
           line_item_usage_start_date
         , tagvalue
         , SUM(buss) business_metric
         FROM
           ${athena_database_name}.sus_buss_kpi
         GROUP BY line_item_usage_start_date, tagvalue
      )
      , acc_business_metrics AS (
         SELECT
           line_item_usage_start_date
         , linkedaccountvalue
         , SUM(buss) business_metric
         FROM
           ${athena_database_name}.sus_buss_kpi
         GROUP BY line_item_usage_start_date, linkedaccountvalue
      )
      SELECT
        cur.bill_payer_account_id
      , cur.line_item_usage_account_id
      , cur.line_item_usage_start_date
      , ${tag} resource_tags_user_application
      , cur.line_item_product_code
      , SUM(cur.line_item_usage_amount) vcpu_hours
      , SUM(susTag.business_metric) tag_business_metric
      , SUM(susAcc.business_metric) account_business_metric
      FROM
        ((${athena_database_name}.${cur_table_name} cur
      LEFT JOIN tag_business_metrics susTag ON ((cur.line_item_usage_start_date = susTag.line_item_usage_start_date) AND (${tag} = susTag.tagValue)))
      LEFT JOIN acc_business_metrics susAcc ON ((cur.line_item_usage_start_date = susAcc.line_item_usage_start_date) AND (cur.line_item_usage_account_id = susAcc.linkedaccountvalue)))
      WHERE (((cur.line_item_usage_type LIKE '%Fargate-vCPU-Hours:perCPU') AND (cur.line_item_product_code IN ('AmazonEKS', 'AmazonECS')) AND (cur.line_item_line_item_type IN ('Usage', 'SavingsPlanCoveredUsage'))) AND ((cur.bill_billing_period_start_date >= (DATE_TRUNC('month', current_timestamp) - INTERVAL  '17' MONTH)) AND (CAST(CONCAT(cur.year, '-', cur.month, '-01') AS date) >= (DATE_TRUNC('month', current_date) - INTERVAL  '17' MONTH))))
      GROUP BY 1, 2, 3, 4, 5
      UNION ALL SELECT
        cur.bill_payer_account_id
      , cur.line_item_usage_account_id
      , cur.line_item_usage_start_date
      , ${tag} resource_tags_user_application
      , cur.line_item_product_code
      , SUM(((cur.line_item_usage_amount / 1769) / 3600)) vcpu_hours
      , SUM(susTag.buss) tag_business_metric
      , SUM(susAcc.buss) account_business_metric
      FROM
        ((${athena_database_name}.${cur_table_name} cur
      LEFT JOIN ${athena_database_name}.sus_buss_kpi susTag ON ((cur.line_item_usage_start_date = susTag.line_item_usage_start_date) AND (${tag} = susTag.tagValue)))
      LEFT JOIN ${athena_database_name}.sus_buss_kpi susAcc ON ((cur.line_item_usage_start_date = susAcc.line_item_usage_start_date) AND (cur.line_item_usage_account_id = susAcc.linkedaccountvalue)))
      WHERE (((cur.line_item_product_code = 'AWSLambda') AND (cur.line_item_usage_type LIKE '%Lambda-GB-Second') AND (cur.line_item_line_item_type IN ('Usage', 'SavingsPlanCoveredUsage'))) AND ((cur.bill_billing_period_start_date >= (DATE_TRUNC('month', current_timestamp) - INTERVAL  '7' MONTH)) AND (CAST(CONCAT(cur.year, '-', cur.month, '-01') AS date) >= (DATE_TRUNC('month', current_date) - INTERVAL  '7' MONTH))))
      GROUP BY 1, 2, 3, 4, 5
      UNION ALL SELECT
        ec2.bill_payer_account_id
      , ec2.line_item_usage_account_id
      , ec2.line_item_usage_start_date
      , ec2.resource_tags_user_application
      , ec2.line_item_product_code
      , ec2.vcpu_hours
      , ec2.tag_business_metric
      , ec2.account_business_metric
      FROM
        ${athena_database_name}.sus_compute_ec2 ec2
  sus_idle_natgw:
    dependsOn:
      views:
      - sus_buss_kpi
      cur: true
    parameters:
      tag:
        type: 'cur.tag_and_cost_category_fields'
        default: resource_tags_user_application
        description: "Enter tag name that is used to categorize workloads"
        global: True
    data: |-
      CREATE OR REPLACE VIEW ${athena_database_name}.sus_idle_natgw AS
      WITH
        TAG_KPI_PER_DAY AS (
         SELECT
           line_item_usage_start_date line_item_usage_start_date
         , tagvalue
         , "sum"(buss) busKpi
         FROM
           ${athena_database_name}.sus_buss_kpi
         GROUP BY line_item_usage_start_date, tagvalue
      )
      , ACC_KPI_PER_DAY AS (
         SELECT
           line_item_usage_start_date line_item_usage_start_date
         , linkedaccountvalue linkedaccountvalue
         , "sum"(buss) busKpi
         FROM
           ${athena_database_name}.sus_buss_kpi
         GROUP BY line_item_usage_start_date, linkedaccountvalue
      )
      SELECT
        bill_payer_account_id
      , line_item_usage_account_id
      , bill_billing_period_start_date
      , "split_part"(line_item_resource_id, ':', 6) split_line_item_resource_id
      , product_region
      , pricing_unit
      , sum_line_item_usage_amount
      , resource_tags_user_application
      , CAST(cost_per_resource AS decimal(16, 8)) sum_line_item_unblended_cost
      , TagBusKpi
      , AccBusKpi
      FROM
        (
         SELECT
           line_item_resource_id
         , bill_billing_period_start_date
         , product_region
         , pricing_unit
         , line_item_usage_account_id
         , bill_payer_account_id
         , ${tag} resource_tags_user_application
         , "sum"(susTag.busKpi) TagBusKpi
         , "sum"(susAcc.busKpi) AccBusKpi
         , "sum"(line_item_usage_amount) sum_line_item_usage_amount
         , "sum"("sum"(line_item_unblended_cost)) OVER (PARTITION BY line_item_resource_id) cost_per_resource
         , "sum"("sum"(line_item_usage_amount)) OVER (PARTITION BY line_item_resource_id, pricing_unit) usage_per_resource_and_pricing_unit
         , "count"(pricing_unit) OVER (PARTITION BY line_item_resource_id, bill_billing_period_start_date) pricing_unit_per_resource
         FROM
           ((${athena_database_name}.${cur_table_name} cur
         LEFT JOIN TAG_KPI_PER_DAY susTag ON ((cur.line_item_usage_start_date = susTag.line_item_usage_start_date) AND (${tag} = susTag.tagValue)))
         LEFT JOIN ACC_KPI_PER_DAY susAcc ON ((cur.line_item_usage_start_date = susAcc.line_item_usage_start_date) AND (cur.line_item_usage_account_id = susAcc.linkedaccountvalue)))
         WHERE ((((line_item_product_code = 'AmazonEC2') AND (line_item_usage_type LIKE '%Nat%')) AND (("bill_billing_period_start_date" >= ("date_trunc"('month', current_timestamp) - INTERVAL  '7' MONTH)) AND (CAST("concat"("year", '-', "month", '-01') AS date) >= ("date_trunc"('month', current_date) - INTERVAL  '7' MONTH)))) AND (line_item_line_item_type = 'Usage'))
         GROUP BY line_item_resource_id, bill_billing_period_start_date, product_region, pricing_unit, line_item_usage_account_id, bill_payer_account_id, 7
      )
      WHERE ((usage_per_resource_and_pricing_unit > 336) AND (pricing_unit_per_resource = 1))
  sus_compute_split:
    dependsOn:
      views:
      - sus_buss_kpi
      - sus_compute_ec2
      cur: true
      parameters:
       tag:
        type: 'cur.tag_and_cost_category_fields'
        default: resource_tags_user_application
        description: "Enter tag name that is used to categorize workloads"
        global: True
    data: |-
      CREATE OR REPLACE VIEW ${athena_database_name}.sus_compute_split AS
      WITH
        tag_business_metrics AS (
         SELECT
           line_item_usage_start_date
         , tagvalue
         , SUM(buss) business_metric
         FROM
           ${athena_database_name}.sus_buss_kpi
         GROUP BY line_item_usage_start_date, tagvalue
      )
      , acc_business_metrics AS (
         SELECT
           line_item_usage_start_date
         , linkedaccountvalue
         , SUM(buss) business_metric
         FROM
           ${athena_database_name}.sus_buss_kpi
         GROUP BY line_item_usage_start_date, linkedaccountvalue
      )
      SELECT
        cur.bill_payer_account_id
      , cur.line_item_usage_account_id
      , cur.line_item_usage_start_date
      , ${tag} resource_tags_user_application
      , cur.line_item_product_code
      , SUM(cur.line_item_usage_amount) vcpu_hours
      , SUM(susTag.business_metric) tag_business_metric
      , SUM(susAcc.business_metric) account_business_metric
      FROM
        ((${athena_database_name}.${cur_table_name} cur
      LEFT JOIN tag_business_metrics susTag ON ((cur.line_item_usage_start_date = susTag.line_item_usage_start_date) AND (${tag} = susTag.tagValue)))
      LEFT JOIN acc_business_metrics susAcc ON ((cur.line_item_usage_start_date = susAcc.line_item_usage_start_date) AND (cur.line_item_usage_account_id = susAcc.linkedaccountvalue)))
      WHERE (((cur.line_item_usage_type LIKE '%Fargate-vCPU-Hours:perCPU') AND (cur.line_item_product_code IN ('AmazonEKS', 'AmazonECS')) AND (cur.line_item_line_item_type IN ('Usage', 'SavingsPlanCoveredUsage'))) AND ((cur.bill_billing_period_start_date >= (DATE_TRUNC('month', current_timestamp) - INTERVAL  '17' MONTH)) AND (CAST(CONCAT(cur.year, '-', cur.month, '-01') AS date) >= (DATE_TRUNC('month', current_date) - INTERVAL  '17' MONTH))))
      GROUP BY 1, 2, 3, 4, 5
      UNION ALL SELECT
        cur.bill_payer_account_id
      , cur.line_item_usage_account_id
      , cur.line_item_usage_start_date
      , ${tag} resource_tags_user_application
      , cur.line_item_product_code
      , SUM(((cur.line_item_usage_amount / 1769) / 3600)) vcpu_hours
      , SUM(susTag.buss) tag_business_metric
      , SUM(susAcc.buss) account_business_metric
      FROM
        ((${athena_database_name}.${cur_table_name} cur
      LEFT JOIN ${athena_database_name}.sus_buss_kpi susTag ON ((cur.line_item_usage_start_date = susTag.line_item_usage_start_date) AND (${tag} = susTag.tagValue)))
      LEFT JOIN ${athena_database_name}.sus_buss_kpi susAcc ON ((cur.line_item_usage_start_date = susAcc.line_item_usage_start_date) AND (cur.line_item_usage_account_id = susAcc.linkedaccountvalue)))
      WHERE (((cur.line_item_product_code = 'AWSLambda') AND (cur.line_item_usage_type LIKE '%Lambda-GB-Second') AND (cur.line_item_line_item_type IN ('Usage', 'SavingsPlanCoveredUsage'))) AND ((cur.bill_billing_period_start_date >= (DATE_TRUNC('month', current_timestamp) - INTERVAL  '7' MONTH)) AND (CAST(CONCAT(cur.year, '-', cur.month, '-01') AS date) >= (DATE_TRUNC('month', current_date) - INTERVAL  '7' MONTH))))
      GROUP BY 1, 2, 3, 4, 5
      UNION ALL SELECT
        ec2.bill_payer_account_id
      , ec2.line_item_usage_account_id
      , ec2.line_item_usage_start_date
      , ec2.resource_tags_user_application
      , ec2.line_item_product_code
      , ec2.vcpu_hours
      , ec2.tag_business_metric
      , ec2.account_business_metric
      FROM
        ${athena_database_name}.sus_compute_ec2 ec2
