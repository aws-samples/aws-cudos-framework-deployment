dashboards:
  RESILIENCEVUEANALYSIS:
    dependsOn:
      datasets:
      - resiliencehub_alarm_recommendations
      - resiliencehub_app_recommendations
      - resiliencehub_complete_view
      - resiliencehub_daily_assessments
      - resiliencehub_resource_types
      - resiliencehub_sop_recommendations
    name: ResilienceVue
    dashboardId: resiliencevueanalysis
    category: Additional
    theme: MIDNIGHT
    templateId: resiliencevueanalysis
    sourceAccountId: '277707120426'
    region: us-east-1
datasets:
  resiliencehub_app_recommendations:
    data:
      DataSetId: b52e053f-0e86-4162-9e22-aeeb099dc585
      Name: resiliencehub_app_recommendations
      PhysicalTableMap:
        66a09b32-e397-46e0-a0da-abf14ab8fd68:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: resiliencehub_app_recommendations
            InputColumns:
            - Name: app_arn
              Type: STRING
            - Name: assessment_arn
              Type: STRING
            - Name: app_component_name
              Type: STRING
            - Name: description
              Type: STRING
            - Name: ha_architecture
              Type: STRING
            - Name: optimization_type
              Type: STRING
            - Name: suggested_changes
              Type: STRING
            - Name: cost
              Type: STRING
        8ac8212d-6f03-4d88-9cf0-710bf8d486f1:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: resiliencehub_daily_assessments
            InputColumns:
            - Name: daytime
              Type: STRING
            - Name: region
              Type: STRING
            - Name: account_id
              Type: STRING
            - Name: application_id
              Type: STRING
            - Name: application_arn
              Type: STRING
            - Name: application_name
              Type: STRING
            - Name: assessment_time
              Type: STRING
            - Name: assessment_arn
              Type: STRING
            - Name: resiliency_status
              Type: STRING
            - Name: resiliency_drift_status
              Type: STRING
            - Name: compliance_total
              Type: STRING
            - Name: fis_tests_total
              Type: STRING
            - Name: alarms_total
              Type: STRING
            - Name: sops_total
              Type: STRING
            - Name: compliance_outstanding
              Type: STRING
            - Name: fis_tests_outstanding
              Type: STRING
            - Name: alarms_outstanding
              Type: STRING
            - Name: sops_outstanding
              Type: STRING
            - Name: compliance_excluded
              Type: STRING
            - Name: fis_tests_excluded
              Type: STRING
            - Name: alarms_excluded
              Type: STRING
            - Name: sops_excluded
              Type: STRING
            - Name: operational_recommendations_total
              Type: STRING
            - Name: operational_recommendations_outstanding
              Type: STRING
            - Name: operational_recommendations_excluded
              Type: STRING
            - Name: input_source_drifts
              Type: STRING
            - Name: app_component_drifts
              Type: STRING
            - Name: resiliency_score
              Type: STRING
      LogicalTableMap:
        42619e72-65e7-4372-8f15-330d2b61355c:
          Alias: resiliencehub_app_recommendations
          Source:
            PhysicalTableId: 66a09b32-e397-46e0-a0da-abf14ab8fd68
        6f0a7483-ff97-4425-97f1-93716afafa1d:
          Alias: resiliencehub_daily_assessments
          DataTransforms:
          - RenameColumnOperation:
              ColumnName: assessment_arn
              NewColumnName: assessment_arn[resiliencehub_daily_assessments]
          Source:
            PhysicalTableId: 8ac8212d-6f03-4d88-9cf0-710bf8d486f1
        7b1add80-195e-4f51-b9c2-83b0bca77a6e:
          Alias: Intermediate Table
          DataTransforms:
          - ProjectOperation:
              ProjectedColumns:
              - app_arn
              - assessment_arn
              - app_component_name
              - description
              - ha_architecture
              - optimization_type
              - suggested_changes
              - cost
              - daytime
              - region
              - account_id
              - application_name
          Source:
            JoinInstruction:
              LeftOperand: 42619e72-65e7-4372-8f15-330d2b61355c
              RightOperand: 6f0a7483-ff97-4425-97f1-93716afafa1d
              Type: LEFT
              OnClause: '{app_arn} = {application_arn}'
      ImportMode: SPICE
    dependsOn:
      views:
      - resiliencehub_app_recommendations
      - resiliencehub_daily_assessments
    schedules:
    - default
  resiliencehub_sop_recommendations:
    data:
      DataSetId: 88a3f39a-0167-459b-bd1a-c3ffe665f982
      Name: resiliencehub_sop_recommendations
      PhysicalTableMap:
        d231f0b0-db58-40d3-bddd-feb15d607015:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: account_map
            InputColumns:
            - Name: account_id
              Type: STRING
            - Name: parent_account_id
              Type: STRING
            - Name: account_name
              Type: STRING
        f0c3275b-0991-49c0-9908-091aa981606e:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: resiliencehub_complete_view
            InputColumns:
            - Name: region
              Type: STRING
            - Name: account_id
              Type: STRING
            - Name: application_id
              Type: STRING
            - Name: application_arn
              Type: STRING
            - Name: application_name
              Type: STRING
            - Name: resiliency_policy_id
              Type: STRING
            - Name: resiliency_policy_arn
              Type: STRING
            - Name: resiliency_policy_name
              Type: STRING
            - Name: last_assessment_time
              Type: STRING
            - Name: last_assessment_arn
              Type: STRING
            - Name: resiliency_status
              Type: STRING
            - Name: resiliency_drift_status
              Type: STRING
            - Name: compliance_total
              Type: STRING
            - Name: fis_tests_total
              Type: STRING
            - Name: alarms_total
              Type: STRING
            - Name: sops_total
              Type: STRING
            - Name: compliance_outstanding
              Type: STRING
            - Name: fis_tests_outstanding
              Type: STRING
            - Name: alarms_outstanding
              Type: STRING
            - Name: sops_outstanding
              Type: STRING
            - Name: compliance_excluded
              Type: STRING
            - Name: fis_tests_excluded
              Type: STRING
            - Name: alarms_excluded
              Type: STRING
            - Name: sops_excluded
              Type: STRING
            - Name: operational_recommendations_total
              Type: STRING
            - Name: operational_recommendations_outstanding
              Type: STRING
            - Name: operational_recommendations_excluded
              Type: STRING
            - Name: infrastructure_recommendations_total
              Type: STRING
            - Name: input_source_drifts
              Type: STRING
            - Name: app_component_drifts
              Type: STRING
            - Name: resiliency_score
              Type: STRING
            - Name: latest_assessment_time
              Type: STRING
            - Name: estimated_overall_rto
              Type: STRING
            - Name: estimated_overall_rpo
              Type: STRING
            - Name: target_rto
              Type: STRING
            - Name: target_rpo
              Type: STRING
            - Name: current_rto_az
              Type: STRING
            - Name: current_rto_hardware
              Type: STRING
            - Name: current_rto_software
              Type: STRING
            - Name: current_rpo_az
              Type: STRING
            - Name: current_rpo_hardware
              Type: STRING
            - Name: current_rpo_software
              Type: STRING
            - Name: target_rto_az
              Type: STRING
            - Name: target_rto_hardware
              Type: STRING
            - Name: target_rto_software
              Type: STRING
            - Name: target_rpo_az
              Type: STRING
            - Name: target_rpo_hardware
              Type: STRING
            - Name: target_rpo_software
              Type: STRING
        f9ebf4d5-8f33-41a9-85c2-3dc5b1a23e1a:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: resiliencehub_sop_recommendations
            InputColumns:
            - Name: app_arn
              Type: STRING
            - Name: assessment_arn
              Type: STRING
            - Name: app_component_name
              Type: STRING
            - Name: description
              Type: STRING
            - Name: alreadyimplemented
              Type: STRING
            - Name: excluded
              Type: STRING
            - Name: resourceid
              Type: STRING
            - Name: targetaccountid
              Type: STRING
            - Name: targetregion
              Type: STRING
            - Name: name
              Type: STRING
            - Name: recommendationstatus
              Type: STRING
      LogicalTableMap:
        41a5c3a7-fce2-47ad-a619-2d1dae88f788:
          Alias: resiliencehub_complete_view
          Source:
            PhysicalTableId: f0c3275b-0991-49c0-9908-091aa981606e
        c8a18b7b-b7db-4d79-a19f-8a5d636740e4:
          Alias: Intermediate Table (2)
          DataTransforms:
          - ProjectOperation:
              ProjectedColumns:
              - app_arn
              - assessment_arn
              - app_component_name
              - description
              - excluded
              - resourceid
              - targetaccountid
              - targetregion
              - name
              - recommendationstatus
              - application_name
              - account_id[account_map]
              - parent_account_id
              - account_name
          Source:
            JoinInstruction:
              LeftOperand: e7d605ba-30d7-48c6-9e4d-28b51ad4d94c
              RightOperand: e13a277c-5508-41dd-b365-108caa1eda0c
              Type: LEFT
              OnClause: '{targetaccountid} = {account_id[account_map]}'
        e13a277c-5508-41dd-b365-108caa1eda0c:
          Alias: account_map
          DataTransforms:
          - RenameColumnOperation:
              ColumnName: account_id
              NewColumnName: account_id[account_map]
          Source:
            PhysicalTableId: d231f0b0-db58-40d3-bddd-feb15d607015
        e7d605ba-30d7-48c6-9e4d-28b51ad4d94c:
          Alias: Intermediate Table
          Source:
            JoinInstruction:
              LeftOperand: fd77cb49-d70b-42f8-8eec-ac4a34397e1b
              RightOperand: 41a5c3a7-fce2-47ad-a619-2d1dae88f788
              Type: LEFT
              OnClause: '{app_arn} = {application_arn}'
        fd77cb49-d70b-42f8-8eec-ac4a34397e1b:
          Alias: resiliencehub_sop_recommendations
          Source:
            PhysicalTableId: f9ebf4d5-8f33-41a9-85c2-3dc5b1a23e1a
      ImportMode: SPICE
    dependsOn:
      views:
      - account_map
      - resiliencehub_complete_view
      - resiliencehub_sop_recommendations
    schedules:
    - default
  resiliencehub_complete_view:
    data:
      DataSetId: 7dfed72c-9d26-46a2-8cbb-855393b51622
      Name: resiliencehub_complete_view
      PhysicalTableMap:
        b0da5234-0bbe-4416-969b-454cea033b21:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: resiliencehub_complete_view
            InputColumns:
            - Name: region
              Type: STRING
            - Name: account_id
              Type: STRING
            - Name: application_id
              Type: STRING
            - Name: application_arn
              Type: STRING
            - Name: application_name
              Type: STRING
            - Name: resiliency_policy_id
              Type: STRING
            - Name: resiliency_policy_arn
              Type: STRING
            - Name: resiliency_policy_name
              Type: STRING
            - Name: last_assessment_time
              Type: STRING
            - Name: last_assessment_arn
              Type: STRING
            - Name: resiliency_status
              Type: STRING
            - Name: resiliency_drift_status
              Type: STRING
            - Name: compliance_total
              Type: STRING
            - Name: fis_tests_total
              Type: STRING
            - Name: alarms_total
              Type: STRING
            - Name: sops_total
              Type: STRING
            - Name: compliance_outstanding
              Type: STRING
            - Name: fis_tests_outstanding
              Type: STRING
            - Name: alarms_outstanding
              Type: STRING
            - Name: sops_outstanding
              Type: STRING
            - Name: compliance_excluded
              Type: STRING
            - Name: fis_tests_excluded
              Type: STRING
            - Name: alarms_excluded
              Type: STRING
            - Name: sops_excluded
              Type: STRING
            - Name: operational_recommendations_total
              Type: STRING
            - Name: operational_recommendations_outstanding
              Type: STRING
            - Name: operational_recommendations_excluded
              Type: STRING
            - Name: infrastructure_recommendations_total
              Type: STRING
            - Name: input_source_drifts
              Type: STRING
            - Name: app_component_drifts
              Type: STRING
            - Name: resiliency_score
              Type: STRING
            - Name: latest_assessment_time
              Type: STRING
            - Name: estimated_overall_rto
              Type: STRING
            - Name: estimated_overall_rpo
              Type: STRING
            - Name: target_rto
              Type: STRING
            - Name: target_rpo
              Type: STRING
            - Name: current_rto_az
              Type: STRING
            - Name: current_rto_hardware
              Type: STRING
            - Name: current_rto_software
              Type: STRING
            - Name: current_rpo_az
              Type: STRING
            - Name: current_rpo_hardware
              Type: STRING
            - Name: current_rpo_software
              Type: STRING
            - Name: target_rto_az
              Type: STRING
            - Name: target_rto_hardware
              Type: STRING
            - Name: target_rto_software
              Type: STRING
            - Name: target_rpo_az
              Type: STRING
            - Name: target_rpo_hardware
              Type: STRING
            - Name: target_rpo_software
              Type: STRING
        d7db2d5a-9c04-4eca-898e-9775ab9d17e6:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: account_map
            InputColumns:
            - Name: account_id
              Type: STRING
            - Name: parent_account_id
              Type: STRING
            - Name: account_name
              Type: STRING
      LogicalTableMap:
        52aac68f-0da2-43a7-8d61-c168f66cf0bf:
          Alias: Intermediate Table
          DataTransforms:
          - CreateColumnsOperation:
              Columns:
              - ColumnName: resiliency_score_percent
                ColumnId: 79960f5f-3124-401a-9ca1-752a2689da40
                Expression: '{resiliency_score}*100'
          - TagColumnOperation:
              ColumnName: region
              Tags:
              - ColumnGeographicRole: STATE
          - ProjectOperation:
              ProjectedColumns:
              - region
              - account_id
              - application_id
              - application_arn
              - application_name
              - resiliency_policy_id
              - resiliency_policy_arn
              - resiliency_policy_name
              - last_assessment_time
              - last_assessment_arn
              - resiliency_status
              - resiliency_drift_status
              - compliance_total
              - fis_tests_total
              - alarms_total
              - sops_total
              - compliance_outstanding
              - fis_tests_outstanding
              - alarms_outstanding
              - sops_outstanding
              - compliance_excluded
              - fis_tests_excluded
              - alarms_excluded
              - sops_excluded
              - operational_recommendations_total
              - operational_recommendations_outstanding
              - operational_recommendations_excluded
              - infrastructure_recommendations_total
              - input_source_drifts
              - app_component_drifts
              - resiliency_score
              - latest_assessment_time
              - estimated_overall_rto
              - estimated_overall_rpo
              - target_rto
              - target_rpo
              - current_rto_az
              - current_rto_hardware
              - current_rto_software
              - current_rpo_az
              - current_rpo_hardware
              - current_rpo_software
              - target_rto_az
              - target_rto_hardware
              - target_rto_software
              - target_rpo_az
              - target_rpo_hardware
              - target_rpo_software
              - account_id[account_map]
              - parent_account_id
              - account_name
              - resiliency_score_percent
          Source:
            JoinInstruction:
              LeftOperand: be21f777-fe71-41ad-894f-262540dfceb8
              RightOperand: 628c6748-7d0c-453c-8f85-9ef4430d3b1e
              Type: LEFT
              OnClause: '{account_id} = {account_id[account_map]}'
        628c6748-7d0c-453c-8f85-9ef4430d3b1e:
          Alias: account_map
          DataTransforms:
          - RenameColumnOperation:
              ColumnName: account_id
              NewColumnName: account_id[account_map]
          Source:
            PhysicalTableId: d7db2d5a-9c04-4eca-898e-9775ab9d17e6
        be21f777-fe71-41ad-894f-262540dfceb8:
          Alias: resiliencehub_complete_view
          DataTransforms:
          - CastColumnTypeOperation:
              ColumnName: last_assessment_time
              NewColumnType: DATETIME
              Format: yyyy-MM-dd HH:mm:ss.SSS
          - CastColumnTypeOperation:
              ColumnName: compliance_total
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: fis_tests_total
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: alarms_total
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: sops_total
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: compliance_outstanding
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: fis_tests_outstanding
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: alarms_outstanding
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: sops_outstanding
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: compliance_excluded
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: fis_tests_excluded
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: alarms_excluded
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: sops_excluded
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: operational_recommendations_total
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: operational_recommendations_outstanding
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: operational_recommendations_excluded
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: infrastructure_recommendations_total
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: input_source_drifts
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: app_component_drifts
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: resiliency_score
              NewColumnType: DECIMAL
              SubType: FIXED
          - CastColumnTypeOperation:
              ColumnName: latest_assessment_time
              NewColumnType: DATETIME
              Format: yyyy-MM-dd HH:mm:ss
          - CastColumnTypeOperation:
              ColumnName: estimated_overall_rto
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: estimated_overall_rpo
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: target_rto
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: target_rpo
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: current_rto_az
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: current_rto_hardware
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: current_rto_software
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: current_rpo_az
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: current_rpo_hardware
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: current_rpo_software
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: target_rto_az
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: target_rto_hardware
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: target_rto_software
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: target_rpo_az
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: target_rpo_hardware
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: target_rpo_software
              NewColumnType: INTEGER
          Source:
            PhysicalTableId: b0da5234-0bbe-4416-969b-454cea033b21
      ImportMode: SPICE
    dependsOn:
      views:
      - resiliencehub_complete_view
      - account_map
    schedules:
    - default
  resiliencehub_daily_assessments:
    data:
      DataSetId: 3ddcd52e-0f02-4ce1-9585-2e73a8b593c6
      Name: resiliencehub_daily_assessments
      PhysicalTableMap:
        db1ae85e-5ef2-42ae-8737-15dbaa7a0192:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: resiliencehub_daily_assessments
            InputColumns:
            - Name: daytime
              Type: STRING
            - Name: region
              Type: STRING
            - Name: account_id
              Type: STRING
            - Name: application_id
              Type: STRING
            - Name: application_arn
              Type: STRING
            - Name: application_name
              Type: STRING
            - Name: assessment_time
              Type: STRING
            - Name: assessment_arn
              Type: STRING
            - Name: resiliency_status
              Type: STRING
            - Name: resiliency_drift_status
              Type: STRING
            - Name: compliance_total
              Type: STRING
            - Name: fis_tests_total
              Type: STRING
            - Name: alarms_total
              Type: STRING
            - Name: sops_total
              Type: STRING
            - Name: compliance_outstanding
              Type: STRING
            - Name: fis_tests_outstanding
              Type: STRING
            - Name: alarms_outstanding
              Type: STRING
            - Name: sops_outstanding
              Type: STRING
            - Name: compliance_excluded
              Type: STRING
            - Name: fis_tests_excluded
              Type: STRING
            - Name: alarms_excluded
              Type: STRING
            - Name: sops_excluded
              Type: STRING
            - Name: operational_recommendations_total
              Type: STRING
            - Name: operational_recommendations_outstanding
              Type: STRING
            - Name: operational_recommendations_excluded
              Type: STRING
            - Name: input_source_drifts
              Type: STRING
            - Name: app_component_drifts
              Type: STRING
            - Name: resiliency_score
              Type: STRING
        faa581b7-6db1-4f7b-8c69-2fd8746cd99a:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: account_map
            InputColumns:
            - Name: account_id
              Type: STRING
            - Name: parent_account_id
              Type: STRING
            - Name: account_name
              Type: STRING
      LogicalTableMap:
        6eda2b3e-7359-4d10-bdb2-c92ede3dba1a:
          Alias: Intermediate Table
          DataTransforms:
          - CreateColumnsOperation:
              Columns:
              - ColumnName: resiliency_score_percent
                ColumnId: 4237aba9-fb5a-448f-999f-a1cc5b334b2c
                Expression: '{resiliency_score}*100'
          - TagColumnOperation:
              ColumnName: region
              Tags:
              - ColumnGeographicRole: STATE
          - ProjectOperation:
              ProjectedColumns:
              - daytime
              - region
              - account_id
              - application_id
              - application_arn
              - application_name
              - assessment_time
              - assessment_arn
              - resiliency_status
              - resiliency_drift_status
              - compliance_total
              - fis_tests_total
              - alarms_total
              - sops_total
              - compliance_outstanding
              - fis_tests_outstanding
              - alarms_outstanding
              - sops_outstanding
              - compliance_excluded
              - fis_tests_excluded
              - alarms_excluded
              - sops_excluded
              - operational_recommendations_total
              - operational_recommendations_outstanding
              - operational_recommendations_excluded
              - input_source_drifts
              - app_component_drifts
              - resiliency_score
              - account_id[account_map]
              - parent_account_id
              - account_name
              - resiliency_score_percent
          Source:
            JoinInstruction:
              LeftOperand: c4ad6c54-5c4c-430f-8c0f-ac455475d3b9
              RightOperand: b865413c-f342-487d-a4b9-babab9cfe4f1
              Type: LEFT
              OnClause: '{account_id} = {account_id[account_map]}'
        b865413c-f342-487d-a4b9-babab9cfe4f1:
          Alias: account_map
          DataTransforms:
          - RenameColumnOperation:
              ColumnName: account_id
              NewColumnName: account_id[account_map]
          Source:
            PhysicalTableId: faa581b7-6db1-4f7b-8c69-2fd8746cd99a
        c4ad6c54-5c4c-430f-8c0f-ac455475d3b9:
          Alias: resiliencehub_daily_assessments
          DataTransforms:
          - CastColumnTypeOperation:
              ColumnName: daytime
              NewColumnType: DATETIME
              Format: yyyy-MM-dd HH:mm:ss.S
          - CastColumnTypeOperation:
              ColumnName: assessment_time
              NewColumnType: DATETIME
              Format: yyyy-MM-dd HH:mm:ss.SSS
          - CastColumnTypeOperation:
              ColumnName: compliance_outstanding
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: fis_tests_outstanding
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: alarms_outstanding
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: sops_outstanding
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: compliance_excluded
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: fis_tests_excluded
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: alarms_excluded
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: sops_excluded
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: operational_recommendations_total
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: operational_recommendations_outstanding
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: operational_recommendations_excluded
              NewColumnType: INTEGER
          - CastColumnTypeOperation:
              ColumnName: resiliency_score
              NewColumnType: DECIMAL
              SubType: FIXED
          Source:
            PhysicalTableId: db1ae85e-5ef2-42ae-8737-15dbaa7a0192
      ImportMode: SPICE
    dependsOn:
      views:
      - resiliencehub_daily_assessments
      - account_map
    schedules:
    - default
  resiliencehub_alarm_recommendations:
    data:
      DataSetId: 95ce0cf3-c870-4e9e-bccd-c71a65ecefa1
      Name: resiliencehub_alarm_recommendations
      PhysicalTableMap:
        4e402ea9-00e0-478b-81da-930a546ed42a:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: resiliencehub_alarm_recommendations
            InputColumns:
            - Name: app_arn
              Type: STRING
            - Name: assessment_arn
              Type: STRING
            - Name: app_component_name
              Type: STRING
            - Name: description
              Type: STRING
            - Name: alreadyimplemented
              Type: STRING
            - Name: excluded
              Type: STRING
            - Name: resourceid
              Type: STRING
            - Name: targetaccountid
              Type: STRING
            - Name: targetregion
              Type: STRING
            - Name: name
              Type: STRING
            - Name: recommendationstatus
              Type: STRING
        88e3c270-7384-46e5-b679-004f21542a3b:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: account_map
            InputColumns:
            - Name: account_id
              Type: STRING
            - Name: parent_account_id
              Type: STRING
            - Name: account_name
              Type: STRING
        93368021-d875-42f8-94ef-b9154b29c28b:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: resiliencehub_complete_view
            InputColumns:
            - Name: region
              Type: STRING
            - Name: account_id
              Type: STRING
            - Name: application_id
              Type: STRING
            - Name: application_arn
              Type: STRING
            - Name: application_name
              Type: STRING
            - Name: resiliency_policy_id
              Type: STRING
            - Name: resiliency_policy_arn
              Type: STRING
            - Name: resiliency_policy_name
              Type: STRING
            - Name: last_assessment_time
              Type: STRING
            - Name: last_assessment_arn
              Type: STRING
            - Name: resiliency_status
              Type: STRING
            - Name: resiliency_drift_status
              Type: STRING
            - Name: compliance_total
              Type: STRING
            - Name: fis_tests_total
              Type: STRING
            - Name: alarms_total
              Type: STRING
            - Name: sops_total
              Type: STRING
            - Name: compliance_outstanding
              Type: STRING
            - Name: fis_tests_outstanding
              Type: STRING
            - Name: alarms_outstanding
              Type: STRING
            - Name: sops_outstanding
              Type: STRING
            - Name: compliance_excluded
              Type: STRING
            - Name: fis_tests_excluded
              Type: STRING
            - Name: alarms_excluded
              Type: STRING
            - Name: sops_excluded
              Type: STRING
            - Name: operational_recommendations_total
              Type: STRING
            - Name: operational_recommendations_outstanding
              Type: STRING
            - Name: operational_recommendations_excluded
              Type: STRING
            - Name: infrastructure_recommendations_total
              Type: STRING
            - Name: input_source_drifts
              Type: STRING
            - Name: app_component_drifts
              Type: STRING
            - Name: resiliency_score
              Type: STRING
            - Name: latest_assessment_time
              Type: STRING
            - Name: estimated_overall_rto
              Type: STRING
            - Name: estimated_overall_rpo
              Type: STRING
            - Name: target_rto
              Type: STRING
            - Name: target_rpo
              Type: STRING
            - Name: current_rto_az
              Type: STRING
            - Name: current_rto_hardware
              Type: STRING
            - Name: current_rto_software
              Type: STRING
            - Name: current_rpo_az
              Type: STRING
            - Name: current_rpo_hardware
              Type: STRING
            - Name: current_rpo_software
              Type: STRING
            - Name: target_rto_az
              Type: STRING
            - Name: target_rto_hardware
              Type: STRING
            - Name: target_rto_software
              Type: STRING
            - Name: target_rpo_az
              Type: STRING
            - Name: target_rpo_hardware
              Type: STRING
            - Name: target_rpo_software
              Type: STRING
      LogicalTableMap:
        2056de99-ec60-4a41-8fb0-33b3bc9339d8:
          Alias: resiliencehub_complete_view
          Source:
            PhysicalTableId: 93368021-d875-42f8-94ef-b9154b29c28b
        4ce694a0-0594-4e43-a884-d4756293af3a:
          Alias: Intermediate Table (2)
          DataTransforms:
          - ProjectOperation:
              ProjectedColumns:
              - app_arn
              - assessment_arn
              - app_component_name
              - description
              - alreadyimplemented
              - excluded
              - resourceid
              - targetaccountid
              - targetregion
              - name
              - recommendationstatus
              - application_arn
              - application_name
              - account_id[account_map]
              - parent_account_id
              - account_name
          Source:
            JoinInstruction:
              LeftOperand: 8b72445e-e633-461d-aa67-d5d4cded1d1c
              RightOperand: d72d2e29-b542-4c67-97f0-142da8aa99e0
              Type: LEFT
              OnClause: '{targetaccountid} = {account_id[account_map]}'
        8b72445e-e633-461d-aa67-d5d4cded1d1c:
          Alias: Intermediate Table
          Source:
            JoinInstruction:
              LeftOperand: e84ff8f7-3149-4868-8777-cfb98bcaa513
              RightOperand: 2056de99-ec60-4a41-8fb0-33b3bc9339d8
              Type: LEFT
              OnClause: '{app_arn} = {application_arn}'
        d72d2e29-b542-4c67-97f0-142da8aa99e0:
          Alias: account_map
          DataTransforms:
          - RenameColumnOperation:
              ColumnName: account_id
              NewColumnName: account_id[account_map]
          Source:
            PhysicalTableId: 88e3c270-7384-46e5-b679-004f21542a3b
        e84ff8f7-3149-4868-8777-cfb98bcaa513:
          Alias: resiliencehub_alarm_recommendations
          Source:
            PhysicalTableId: 4e402ea9-00e0-478b-81da-930a546ed42a
      ImportMode: SPICE
    dependsOn:
      views:
      - resiliencehub_alarm_recommendations
      - account_map
      - resiliencehub_complete_view
    schedules:
    - default
  resiliencehub_resource_types:
    data:
      DataSetId: 6ecc4d2c-2560-49d0-bdb7-2591635edc7b
      Name: resiliencehub_resource_types
      PhysicalTableMap:
        cf27846e-4ca4-4862-a8fa-09831170078e:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: account_map
            InputColumns:
            - Name: account_id
              Type: STRING
            - Name: parent_account_id
              Type: STRING
            - Name: account_name
              Type: STRING
        d08ae176-035a-4463-8ebc-16579f4ad36f:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: resiliencehub_resource_types
            InputColumns:
            - Name: region
              Type: STRING
            - Name: account_id
              Type: STRING
            - Name: resource_type
              Type: STRING
            - Name: app_component_type
              Type: STRING
            - Name: applications
              Type: STRING
            - Name: recommendations
              Type: STRING
      LogicalTableMap:
        5f5d2bc2-1134-47dc-8761-81afdf6e3089:
          Alias: Intermediate Table
          DataTransforms:
          - TagColumnOperation:
              ColumnName: region
              Tags:
              - ColumnGeographicRole: STATE
          - ProjectOperation:
              ProjectedColumns:
              - region
              - account_id
              - resource_type
              - app_component_type
              - applications
              - recommendations
              - account_id[account_map]
              - parent_account_id
              - account_name
          Source:
            JoinInstruction:
              LeftOperand: 84b1c778-9286-44b9-92c4-a79800cf72ec
              RightOperand: d3469e3f-5dbe-4570-8694-6f713b7cb4b6
              Type: LEFT
              OnClause: '{account_id} = {account_id[account_map]}'
        84b1c778-9286-44b9-92c4-a79800cf72ec:
          Alias: resiliencehub_resource_types
          Source:
            PhysicalTableId: d08ae176-035a-4463-8ebc-16579f4ad36f
        d3469e3f-5dbe-4570-8694-6f713b7cb4b6:
          Alias: account_map
          DataTransforms:
          - RenameColumnOperation:
              ColumnName: account_id
              NewColumnName: account_id[account_map]
          Source:
            PhysicalTableId: cf27846e-4ca4-4862-a8fa-09831170078e
      ImportMode: SPICE
    dependsOn:
      views:
      - account_map
      - resiliencehub_resource_types
    schedules:
    - default
crawlers: {}
views:
  resiliencehub_complete_view:
    dependsOn:
      views:
      - resiliencehub_application_rto_rpo
      - resiliencehub_applications
    data: |-
      CREATE OR REPLACE VIEW "${athena_database_name}".resiliencehub_complete_view AS
      WITH
        latest_assessment_rto_rpo AS (
         SELECT
           app_arn
         , assessment_arn
         , assessment_time
         , estimated_overall_rto
         , estimated_overall_rpo
         , target_rto
         , target_rpo
         , current_rto_az
         , current_rto_hardware
         , current_rto_software
         , current_rpo_az
         , current_rpo_hardware
         , current_rpo_software
         , target_rto_az
         , target_rto_hardware
         , target_rto_software
         , target_rpo_az
         , target_rpo_hardware
         , target_rpo_software
         FROM
           (
            SELECT
              *
            , ROW_NUMBER() OVER (PARTITION BY app_arn ORDER BY CAST(assessment_time AS timestamp) DESC) rn
            FROM
              resiliencehub_application_rto_rpo
         )  ranked
         WHERE (rn = 1)
      )
      SELECT
        apps.Region
      , apps.Account_Id
      , apps.Application_Id
      , apps.Application_Arn
      , apps.Application_Name
      , apps.Resiliency_Policy_Id
      , apps.Resiliency_Policy_Arn
      , apps.Resiliency_Policy_Name
      , apps.Last_Assessment_Time
      , apps.Last_Assessment_Arn
      , apps.Resiliency_Status
      , apps.Resiliency_Drift_Status
      , apps.Compliance_Total
      , apps.FIS_Tests_Total
      , apps.Alarms_Total
      , apps.SOPs_Total
      , apps.Compliance_Outstanding
      , apps.FIS_Tests_Outstanding
      , apps.Alarms_Outstanding
      , apps.SOPs_Outstanding
      , apps.Compliance_Excluded
      , apps.FIS_Tests_Excluded
      , apps.Alarms_Excluded
      , apps.SOPs_Excluded
      , apps.Operational_Recommendations_Total
      , apps.Operational_Recommendations_Outstanding
      , apps.Operational_Recommendations_Excluded
      , apps.Infrastructure_Recommendations_Total
      , apps.Input_Source_Drifts
      , apps.App_Component_Drifts
      , apps.Resiliency_Score
      , rto_rpo.assessment_time latest_assessment_time
      , rto_rpo.estimated_overall_rto
      , rto_rpo.estimated_overall_rpo
      , rto_rpo.target_rto
      , rto_rpo.target_rpo
      , rto_rpo.current_rto_az
      , rto_rpo.current_rto_hardware
      , rto_rpo.current_rto_software
      , rto_rpo.current_rpo_az
      , rto_rpo.current_rpo_hardware
      , rto_rpo.current_rpo_software
      , rto_rpo.target_rto_az
      , rto_rpo.target_rto_hardware
      , rto_rpo.target_rto_software
      , rto_rpo.target_rpo_az
      , rto_rpo.target_rpo_hardware
      , rto_rpo.target_rpo_software
      FROM
        (resiliencehub_applications apps
      LEFT JOIN latest_assessment_rto_rpo rto_rpo ON (regexp_replace(apps.Application_Arn, '"', '') = regexp_replace(rto_rpo.app_arn, '"', '')))
      WHERE (apps.Application_Arn IS NOT NULL)


  
